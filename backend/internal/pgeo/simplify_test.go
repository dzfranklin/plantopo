package pgeo

import (
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
	"github.com/tidwall/geojson/geometry"
	"testing"
)

var testLine = geometry.NewLine([]geometry.Point{
	{X: 224.55, Y: 250.15}, {X: 226.91, Y: 244.19}, {X: 233.31, Y: 241.45}, {X: 234.98, Y: 236.06},
	{X: 244.21, Y: 232.76}, {X: 262.59, Y: 215.31}, {X: 267.76, Y: 213.81}, {X: 273.57, Y: 201.84},
	{X: 273.12, Y: 192.16}, {X: 277.62, Y: 189.03}, {X: 280.36, Y: 181.41}, {X: 286.51, Y: 177.74},
	{X: 292.41, Y: 159.37}, {X: 296.91, Y: 155.64}, {X: 314.95, Y: 151.37}, {X: 319.75, Y: 145.16},
	{X: 330.33, Y: 137.57}, {X: 341.48, Y: 139.96}, {X: 369.98, Y: 137.89}, {X: 387.39, Y: 142.51},
	{X: 391.28, Y: 139.39}, {X: 409.52, Y: 141.14}, {X: 414.82, Y: 139.75}, {X: 427.72, Y: 127.3},
	{X: 439.6, Y: 119.74}, {X: 474.93, Y: 107.87}, {X: 486.51, Y: 106.75}, {X: 489.2, Y: 109.45},
	{X: 493.79, Y: 108.63}, {X: 504.74, Y: 119.66}, {X: 512.96, Y: 122.35}, {X: 518.63, Y: 120.89},
	{X: 524.09, Y: 126.88}, {X: 529.57, Y: 127.86}, {X: 534.21, Y: 140.93}, {X: 539.27, Y: 147.24},
	{X: 567.69, Y: 148.91}, {X: 575.25, Y: 157.26}, {X: 580.62, Y: 158.15}, {X: 601.53, Y: 156.85},
	{X: 617.74, Y: 159.86}, {X: 622, Y: 167.04}, {X: 629.55, Y: 194.6}, {X: 638.9, Y: 195.61},
	{X: 641.26, Y: 200.81}, {X: 651.77, Y: 204.56}, {X: 671.55, Y: 222.55}, {X: 683.68, Y: 217.45},
	{X: 695.25, Y: 219.15}, {X: 700.64, Y: 217.98}, {X: 703.12, Y: 214.36}, {X: 712.26, Y: 215.87},
	{X: 721.49, Y: 212.81}, {X: 727.81, Y: 213.36}, {X: 729.98, Y: 208.73}, {X: 735.32, Y: 208.2},
	{X: 739.94, Y: 204.77}, {X: 769.98, Y: 208.42}, {X: 779.6, Y: 216.87}, {X: 784.2, Y: 218.16},
	{X: 800.24, Y: 214.62}, {X: 810.53, Y: 219.73}, {X: 817.19, Y: 226.82}, {X: 820.77, Y: 236.17},
	{X: 827.23, Y: 236.16}, {X: 829.89, Y: 239.89}, {X: 851, Y: 248.94}, {X: 859.88, Y: 255.49},
	{X: 865.21, Y: 268.53}, {X: 857.95, Y: 280.3}, {X: 865.48, Y: 291.45}, {X: 866.81, Y: 298.66},
	{X: 864.68, Y: 302.71}, {X: 867.79, Y: 306.17}, {X: 859.87, Y: 311.37}, {X: 860.08, Y: 314.35},
	{X: 858.29, Y: 314.94}, {X: 858.1, Y: 327.6}, {X: 854.54, Y: 335.4}, {X: 860.92, Y: 343}, {X: 856.43, Y: 350.15},
	{X: 851.42, Y: 352.96}, {X: 849.84, Y: 359.59}, {X: 854.56, Y: 365.53}, {X: 849.74, Y: 370.38},
	{X: 844.09, Y: 371.89}, {X: 844.75, Y: 380.44}, {X: 841.52, Y: 383.67}, {X: 839.57, Y: 390.4},
	{X: 845.59, Y: 399.05}, {X: 848.4, Y: 407.55}, {X: 843.71, Y: 411.3}, {X: 844.09, Y: 419.88},
	{X: 839.51, Y: 432.76}, {X: 841.33, Y: 441.04}, {X: 847.62, Y: 449.22}, {X: 847.16, Y: 458.44},
	{X: 851.38, Y: 462.79}, {X: 853.97, Y: 471.15}, {X: 866.36, Y: 480.77},
}, nil)

var testLineSimplifiedNotBest = []geometry.Point{
	{X: 224.55, Y: 250.15}, {X: 267.76, Y: 213.81}, {X: 296.91, Y: 155.64}, {X: 330.33, Y: 137.57},
	{X: 409.52, Y: 141.14}, {X: 439.60, Y: 119.74}, {X: 486.51, Y: 106.75}, {X: 529.57, Y: 127.86},
	{X: 539.27, Y: 147.24}, {X: 617.74, Y: 159.86}, {X: 629.55, Y: 194.60}, {X: 671.55, Y: 222.55},
	{X: 727.81, Y: 213.36}, {X: 739.94, Y: 204.77}, {X: 769.98, Y: 208.42}, {X: 779.60, Y: 216.87},
	{X: 800.24, Y: 214.62}, {X: 820.77, Y: 236.17}, {X: 859.88, Y: 255.49}, {X: 865.21, Y: 268.53},
	{X: 857.95, Y: 280.30}, {X: 867.79, Y: 306.17}, {X: 859.87, Y: 311.37}, {X: 854.54, Y: 335.40},
	{X: 860.92, Y: 343.00}, {X: 849.84, Y: 359.59}, {X: 854.56, Y: 365.53}, {X: 844.09, Y: 371.89},
	{X: 839.57, Y: 390.40}, {X: 848.40, Y: 407.55}, {X: 839.51, Y: 432.76}, {X: 853.97, Y: 471.15},
	{X: 866.36, Y: 480.77},
}

var testLineSimplifiedBest = []geometry.Point{
	{X: 224.55, Y: 250.15}, {X: 267.76, Y: 213.81}, {X: 296.91, Y: 155.64}, {X: 330.33, Y: 137.57},
	{X: 409.52, Y: 141.14}, {X: 439.6, Y: 119.74}, {X: 486.51, Y: 106.75}, {X: 529.57, Y: 127.86},
	{X: 539.27, Y: 147.24}, {X: 617.74, Y: 159.86}, {X: 629.55, Y: 194.6}, {X: 671.55, Y: 222.55},
	{X: 727.81, Y: 213.36}, {X: 739.94, Y: 204.77}, {X: 769.98, Y: 208.42}, {X: 784.2, Y: 218.16},
	{X: 800.24, Y: 214.62}, {X: 820.77, Y: 236.17}, {X: 859.88, Y: 255.49}, {X: 865.21, Y: 268.53},
	{X: 857.95, Y: 280.3}, {X: 867.79, Y: 306.17}, {X: 858.29, Y: 314.94}, {X: 854.54, Y: 335.4},
	{X: 860.92, Y: 343}, {X: 849.84, Y: 359.59}, {X: 854.56, Y: 365.53}, {X: 844.09, Y: 371.89}, {X: 839.57, Y: 390.4},
	{X: 848.4, Y: 407.55}, {X: 839.51, Y: 432.76}, {X: 853.97, Y: 471.15}, {X: 866.36, Y: 480.77},
}

func TestSimplifyNotBest(t *testing.T) {
	got := Simplify(testLine, 5, false)
	assert.Equal(t, testLineSimplifiedNotBest, LinePoints(got))
}

func TestSimplifyBest(t *testing.T) {
	got := Simplify(testLine, 5, true)
	assert.Equal(t, testLineSimplifiedBest, LinePoints(got))
}

func TestSimplifyOnePoint(t *testing.T) {
	got := Simplify(geometry.NewLine([]geometry.Point{{X: 1, Y: 2}}, nil), 5, false)
	require.Equal(t, []geometry.Point{{X: 1, Y: 2}}, LinePoints(got))
}

func TestSimplifyNoPoints(t *testing.T) {
	got := Simplify(geometry.NewLine(nil, nil), 5, false)
	require.Zero(t, got.NumPoints())
}
